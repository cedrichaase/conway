var Cell=function(a,b,c){return this.init(a,b,c),{value:this.value,toggleValue:this.toggleValue,x:this.x,y:this.y}};Cell.prototype.init=function(a,b,c){this.x=a,this.y=b,this.value=c},Cell.prototype.toggleValue=function(){this.value=!this.value};var Grid=function(a,b){return this.init(a,b),{width:this.width,height:this.height,matrix:this.matrix,getNeighbors:this.getNeighbors,countNeighbors:this.countNeighbors,cellIsBorn:this.cellIsBorn,cellDies:this.cellDies,executeConway:this.executeConway,getCell:this.getCell,toggleCell:this.toggleCell}};Grid.prototype.init=function(a,b){this.width=a,this.height=b,this.matrix=[];for(var c=0;a>c;c++){this.matrix[c]=[];for(var d=0;b>d;d++)this.matrix[c][d]=new Cell(c,d,!1)}},Grid.prototype.toggleCell=function(a,b){this.getCell(a,b).toggleValue()},Grid.prototype.getCell=function(a,b){var c=new Cell(0,0,!1);return 0>a||0>b||a>=this.width||b>=this.height||(c=this.matrix[a][b]),c},Grid.prototype.getNeighbors=function(a,b){return{topLeft:this.getCell(a-1,b-1),top:this.getCell(a,b-1),topRight:this.getCell(a+1,b-1),right:this.getCell(a+1,b),bottomRight:this.getCell(a+1,b+1),bottom:this.getCell(a,b+1),bottomLeft:this.getCell(a-1,b+1),left:this.getCell(a-1,b)}},Grid.prototype.countNeighbors=function(a){var b=this.getNeighbors(a.x,a.y),c=0;return b.top.value&&c++,b.bottom.value&&c++,b.left.value&&c++,b.right.value&&c++,b.topLeft.value&&c++,b.topRight.value&&c++,b.bottomLeft.value&&c++,b.bottomRight.value&&c++,c},Grid.prototype.cellDies=function(a){var b=this.countNeighbors(a);return a.value&&(b>3||2>b)},Grid.prototype.cellIsBorn=function(a){var b=this.countNeighbors(a);return!a.value&&3==b},Grid.prototype.executeConway=function(){for(var a=$.extend(!0,{},this),b=this.width,c=this.height,d=0;b>d;d++)for(var e=0;c>e;e++){var f=this.getCell(d,e),g=a.getCell(d,e);!f.value==!0?this.cellIsBorn(f)&&(g.value=!0):f.value===!0&&(g.value=!this.cellDies(f))}return a},function(a,b,c,d){"use strict";var e="conway",f={};f.settings={injectStyle:!0,gridColor:"#000",gridLineWidth:1,showGrid:!0,hCells:32,vCells:24,borderColor:"#000",borderStyle:"none",borderWidth:"4px",borderRadius:"0px",background:"none",font:"12px Arial"};var g=function(b,c){return this.element=b,this.$element=a(b),this.elementId=b.id,this.styleId=this.elementId+"-style",this.ctx=this.element.getContext("2d"),this.radius=this.element.height>this.element.width?this.element.width:this.element.height,this.executing=!1,this.init(c),{options:this.options,init:a.proxy(this.init,this),remove:a.proxy(this.remove,this),start:a.proxy(this.start,this),stop:a.proxy(this.stop,this),toggleRunning:a.proxy(this.toggleRunning,this),execute:a.proxy(this.execute,this),toggleExecution:a.proxy(this.toggleExecution,this),toggleGrid:a.proxy(this.toggleGrid,this),setGridColor:a.proxy(this.setGridColor,this)}};g.prototype.init=function(b){this.options=a.extend({},f.settings,b),this.destroy(),this.grid=new Grid(this.options.hCells,this.options.vCells),this.injectStyle(),this.render(),this.addListeners(),this.start(),this.initialized=!0},g.prototype.toggleExecution=function(){this.executing=!this.executing},g.prototype.toggleGrid=function(){this.options.showGrid=!this.options.showGrid},g.prototype.setGridColor=function(a){this.options.gridColor=a.gridColor},g.prototype.toggleRunning=function(){this.running?this.stop():this.start()},g.prototype.stop=function(){this.running&&(clearInterval(this.interval),this.running=!1)},g.prototype.start=function(){if(!this.running){var a=this;this.interval=setInterval(function(){a.render()},100),this.running=!0}},g.prototype.render=function(){var a=(this.radius,this.element.width),b=this.element.height;this.ctx.clearRect(0,0,a,b),this.executing&&this.execute(),this.options.showGrid&&this.drawGrid(this.options.hCells,this.options.vCells,this.options.gridLineWidth,this.options.gridColor),this.drawBoolMatrix(this.grid.matrix)},g.prototype.getMouse=function(a){var b=this.$element.offset(),c=a.pageX-b.left,d=a.pageY-b.top;return{x:c,y:d}},g.prototype.getCellByCoords=function(a,b){var c=Math.floor(a/this.element.width*this.options.hCells),d=Math.floor(b/this.element.height*this.options.vCells);return{x:c,y:d}},g.prototype.execute=function(){this.grid=this.grid.executeConway()},g.prototype.addListeners=function(){var a=this;this.element.addEventListener("mousedown",function(b){var c=a.getMouse(b),d=a.getCellByCoords(c.x,c.y);a.grid.toggleCell(d.x,d.y)})},g.prototype.drawBoolMatrix=function(a){for(var b=0;b<a.length;b++)for(var c=0;c<a[b].length;c++)a[b][c].value&&this.fillCell(b,c)},g.prototype.getRandomBoolMatrix=function(a,b){for(var c=[],d=0;a>d;d++){c[d]=[];for(var e=0;b>e;e++)c[d][e]=this.getRandomBool()}return c},g.prototype.getRandomBool=function(){return Math.random()<.5},g.prototype.drawGrid=function(a,b,c,d){for(var e=this.element.width,f=this.element.height,g=e/a,h=f/b,i=0;a>=i;i++){var j=i*g;this.drawVerticalLine(j,c,d)}for(var k=0;b>=k;k++){var l=k*h;this.drawHorizontalLine(l,c,d)}},g.prototype.drawHorizontalLine=function(a,b,c){var d=this.element.width;this.ctx.save(),this.ctx.strokeStyle=c,this.ctx.fillStyle=c,this.ctx.lineWidth=b,this.ctx.beginPath(),this.ctx.moveTo(0,a),this.ctx.lineTo(d,a),this.ctx.stroke(),this.ctx.restore()},g.prototype.drawVerticalLine=function(a,b,c){var d=this.element.height;this.ctx.save(),this.ctx.strokeStyle=c,this.ctx.fillStyle=c,this.ctx.lineWidth=b,this.ctx.beginPath(),this.ctx.moveTo(a,0),this.ctx.lineTo(a,d),this.ctx.stroke(),this.ctx.restore()},g.prototype.fillCell=function(a,b){var c=this.element.width/this.options.hCells,d=this.element.height/this.options.vCells,e=a*c,f=b*d;this.ctx.save(),this.ctx.fillRect(e,f,c,d),this.ctx.restore()},g.prototype.injectStyle=function(){this.options.injectStyle&&!c.getElementById(this.styleId)&&a('<style type="text/css" id="'+this.styleId+'"> '+this.buildStyle()+" </style>").appendTo("head")},g.prototype.buildStyle=function(){var a="#"+this.elementId+"{";return this.options.background&&(a+="background:"+this.options.background+";"),this.options.borderColor&&this.options.borderStyle&&this.options.borderWidth&&(a+="border: "+this.options.borderWidth+" "+this.options.borderStyle+" "+this.options.borderColor+";"),this.options.borderRadius&&(a+="border-radius: "+this.options.borderRadius+";"),a+="}"},g.prototype.destroy=function(){this.initialized&&(this.stop(),this.initialized=!1)},g.prototype.remove=function(){this.destroy(),a.removeData(this,e),a("#"+this.styleId).remove()};var h=function(a){b.console&&b.console.error(a)};a.fn[e]=function(b,c){var d;return this.each(function(){var f=a.data(this,e);"string"==typeof b?f?a.isFunction(f[b])&&"_"!==b.charAt(0)?(c instanceof Array||(c=[c]),d=f[b].apply(f,c)):h("No such method : "+b):h("Not initialized, can not call method : "+b):"boolean"==typeof b?d=f:a.data(this,e,new g(this,a.extend(!0,{},b)))}),d||this}}(jQuery,window,document);